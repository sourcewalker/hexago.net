"use strict";function submitVote(e){InventorModule.processForm(e)}var validate={isEmpty:function(e){var t=new RegExp;return t.compile("^[s ]*$","gi"),t.test(e)},validateRegex:function(e,t){return!!new RegExp(e).test(t)},verifySpecialCharEmail:function(e){for(var t=0,a=e,r=0;r<a.length;r++)-1<"!#$ ".indexOf(a.charAt(r))&&t++;return 0==t},validateProcess:function(e){if("true"==e.attr("data-require")){var t=e.val(),a=e.attr("data-type"),r=e.attr("data-error-target"),o=0;if("text"==a&&(""==t||this.isEmpty(t)?(this.error_message("error",e,r,e.attr("data-required-message")),o++):this.error_message("good",e,r,"")),"regex"==a&&(""==t||this.isEmpty(t)?(this.error_message("error",e,r,e.attr("data-required-message")),o++):this.validateRegex(e.attr("data-regex-pattern"),t)?"email"==e.attr("type")?this.verifySpecialCharEmail(t)?1<(t.match(/@/g)||[]).length?(this.error_message("error",e,r,e.attr("data-pattern-message")),o++):this.error_message("good",e,r,""):(this.error_message("error",e,r,e.attr("data-pattern-message")),o++):this.error_message("good",e,r,""):(this.error_message("error",e,r,e.attr("data-pattern-message")),o++)),"ddl"==a&&("default"==t?(this.error_message("error",e,r,e.attr("data-required-message")),o++):this.error_message("good",e,r,"")),"checkbox"==a&&(e.is(":checked")?this.error_message("good",e,r,"",a):(this.error_message("error",e,r,e.attr("data-required-message"),a),o++)),"radio"==a){var i=e.closest("form").attr("id"),n=e.attr("name");0==$("#"+i).find("input[name="+n+"]:checked").length?(this.error_message("error",e,r,e.attr("data-required-message")),o++):this.error_message("good",e,r,"")}return 0==o}},validateField:function(e){$(e).find("input[type=text], input[type=email]").on("blur",function(){validate.validateProcess($(this))}),$(e).find("select").on("change",function(){validate.validateProcess($(this))}),$(e).find("input[type=checkbox]").on("change",function(){validate.validateProcess($(this))}),$(e).find("input[type=radio]").on("change",function(){validate.validateProcess($(this))})},validateForm:function(e){var t=0;return $(e).find("input[type=text], input[type=email], select, input[type=checkbox], input[type=radio]").each(function(){"true"==$(this).attr("data-require")&&(validate.validateProcess($(this))||t++)}),0==t},error_message:function(e,t,a,r,o){"error"==e?("checkbox"==o&&t.siblings(".checkmark").addClass("notvalid"),t.removeClass("valid").addClass("notvalid")):("checkbox"==o&&t.siblings(".checkmark").removeClass("notvalid"),t.removeClass("notvalid").addClass("valid"))}},inventorVoteAnimation={maxChunk:12,chocoImgHTML:$("#js-temp-view-chunk").html(),chocoImgAnimeHTML:$("#js-temp-view-chunk-animation").html(),selectorSlot:null,chunkPosition:["margin-left: 0","margin-left: 8px;","margin-left: 0","margin-left: -8px;","margin-left: 0","margin-left: 8px;","margin-left: 0;","margin-left: -8px;","margin-left: 0;","margin-left: 8px;","margin-left: 0;"],launchAnimation:function(e,t){var a=$(e[t].slot),r=e[t].number,o=r,i=r,n=0,s=setInterval(function(){var e=47*o-20;1==i&&(o=0);a.find("img").eq(o).fadeIn("fast",function(){$(this).animate({marginTop:"+="+e+"px"},{duration:200,complete:function(){}})}),o--,++n==r&&clearInterval(s)},600)},processChunkImg:function(e,t,a){for(var r=$(e),o="",i=10*t,n=0,s=this.chunkPosition.reverse(),c=0,l=0;l<t;l++)i-=10,n=-50,o+=this.chocoImgHTML.replace("{{zindex}}",i).replace("{{margintop}}",n+"px").replace("{{marginposition}}",s[l]);r.html(o),c=1==t||2==t?110:3==t?160:4==t?205:5==t?252:6==t?300:7==t?345:8==t?395:9==t?438:10==t?485:r.height(),r.css("height",c+"px"),r.addClass("setposition")},slotChunkoutput:function(e){for(var t=e.length,a=0;a<t;a++)this.processChunkImg(e[a].slot,e[a].number)}},Retailer={details:[{name:"booker",consentText:'Picked up your limited-edition bar in Booker? Tick the box to be entered into the store\'s exclusive prize draw. By ticking you\'re confirming that you\'re over 18 and agree to the <a href="https://www.cadbury.co.uk/terms-and-conditions/Inventorbooker" target="_blank" rel="noopener noreferrer">Terms & Conditions</a> for the Booker prize draw. Proof of purchase may be necessary to claim your prize.',confirmation:{header:"You could be jetting off to Brazil!",htmlContent:"<p>We have great news... because you bought a Cadbury Dairy Milk bar, you've been entered into an extra special prize draw. If you're one of our lucky winners you'll be heading off to Brazil on an epic trip you'll Go Madbury for!</p><p>We'll be in touch via email if you win so keep an eye out.</p><p class=\"high\">Proof of purchase at Booker may be required to redeem prize.</p>"},optin:!0},{name:"onestop",consentText:'Picked up your limited-edition bar in One Stop? Tick the box to be entered into the store\'s exclusive prize draw. By ticking you\'re confirming that you\'re over 18 and agree to the <a href="https://www.cadbury.co.uk/terms-and-conditions/InventorOneStop" target="_blank" rel="noopener noreferrer">Terms & Conditions</a> for the One Stop prize draw. Proof of purchase may be necessary to claim your prize.',confirmation:{header:"You're in with a chance of winning a trip to California",htmlContent:"<p>Here's some great news... because you bought a Cadbury Dairy Milk bar at One Stop, you've been entered into an extra special prize draw. If you're one of our lucky winners you'll be heading off to California on an epic trip you'll Go Madbury for!</p><p>We'll be in touch via email if you win so keep an eye out.</p><p class=\"high\">Proof of purchase at One Stop may be required to redeem prize.</p>"},optin:!0},{name:"tesco",consentText:'Picked up your limited-edition bar in Tesco? Tick the box to be entered into the store\'s exclusive prize draw. By ticking you\'re confirming that you\'re over 18 and agree to the <a href="https://www.cadbury.co.uk/terms-and-conditions/InventorTesco" target="_blank" rel="noopener noreferrer">Terms & Conditions</a> for the Tesco prize draw. Proof of purchase may be necessary to claim your prize. UK 18+. 17/07/2019 - 27/08/2019. Prizes: 3 x holidays up for grabs. Destinations: Mauritius, Los Angeles and New York. Each holiday is for 1 winner plus 1 guest, both must be 18+ and for Los Angeles and New York, either the winner or guest must be 21+. 1 entry per person, per email. 1 prize per person. Passport with minimum of 6 months validity + visa required for travel.',confirmation:{header:"Go Madbury in 1 of 3 holidays with Tesco",htmlContent:"<p>Great news! Because you bought your Cadbury Dairy Milk bar at Tesco, you've been entered into an extra special prize draw. We're giving you the chance to Go Madbury abroad, with an epic trip tailored to your choice of flavour: buzzing New York for Choca-latte, delicious Mauritius for The Raspberry Shortcake, or sunny Los Angeles for Simply the Zest.</p><p>We'll be in touch via email if you're one of our lucky winners.</p><p class=\"high\">Proof of purchase at Tesco may be required to redeem prize.</p>"},optin:!0},{name:"other",consentText:'Picked up your limited-edition bar in BRP? Tick the box to be entered into the store\'s exclusive prize draw. By ticking you\'re confirming that you\'re over 18 and agree to the <a href="https://www.cadbury.co.uk/terms-and-conditions/InventorBrp" target="_blank" rel="noopener noreferrer">Terms & Conditions</a> for the BRP prize draw. Proof of purchase may be necessary to claim your prize.',confirmation:{header:"You could be jetting off to Mexico!",htmlContent:"<p>We have great news... because you bought a Cadbury Dairy Milk bar, you've been entered into an extra special prize draw. If you're one of our lucky winners you'll be heading off to Mexico on an epic trip you'll Go Madbury for!</p><p class=\"high\">Proof of purchase at BRP may be required to redeem prize.</p>"},optin:!0}]},InventorModule={retailerName:"",startAnimation:!0,slots:null,retailerOptin:function(e){for(var t=Retailer.details.length,a=Retailer.details,r="",o=!1,i=0;i<t;i++)if(1==a[i].optin&&a[i].name==e){o=!0,r=a[i].consentText;break}1==o?($(".js-retailerconsent-text").html(r),$(".js-view-retailerconsent").show()):($(".js-view-retailerconsent").hide(),$("#retailerconsent").attr("data-require",!1))},getFlavoursValue:function(){var t=[];return $(".js-view-flavours .js-select-radio").each(function(){var e=$(this);e.is(":checked")&&"none-yet"!=e.val()&&t.push(e.val())}),t},getFlavourName:function(){var t="";return $(".js-view-flavours .js-select-radio").each(function(){var e=$(this);e.is(":checked")&&(t+=e.attr("data-flavourname")+"|")}),t.slice(0,-1)},confirmationMessage:function(){for(var e=this.retailerName,t=Retailer.details.length,a=Retailer.details,r=0;r<t;r++)if(a[r].name==e&&1==$("#retailerconsent").is(":checked")){$(".plan-deco").show(),$(".js-view-header-confirmation").html(a[r].confirmation.header).show(),$(".js-view-confirmation-text").html(a[r].confirmation.htmlContent);break}},prizeDraw:function(){for(var e=this.retailerName,t=Retailer.details.length,a=Retailer.details,r="NA",o=0;o<t;o++)if(a[o].name==e){r=a[o].confirmation.header;break}return r},processCaptcha:function(){try{""!=grecaptcha.getResponse()&&grecaptcha.reset(),grecaptcha.execute()}catch(e){console.log("Google Captcha: "+e)}},processForm:function(e){var u=this;$("#js-submit-vote").attr("disabled",!0),$(".js-view-loader").show();var t="";t=-1<window.location.host.indexOf("azurewebsites")?"https://services-cadburyinventor-staging.azurewebsites.net/vote/participate":-1<window.location.host.indexOf("local")?"http://local.inventor-voting.service.co.uk/vote/participate":"https://services.cadburyinventor.com/vote/participate";var a={SelectedChocolateId:$("#barselected").val(),Email:$("#email").val(),SelectedRetailerId:$("#retailer").val(),TriedFlavours:this.getFlavoursValue(),SelectedPlaceId:$("#location").val(),Culture:"en-GB",RetailerConsent:$("#retailerconsent").is(":checked"),NewsletterOptin:$("#newsletter").is(":checked"),Captcha:e},r={cache:!1,url:t,method:"POST",headers:{Authorization:"Basic "+btoa("Proximity:k2P6WnRQEgPCmt7q8mtKfLW6bW4fcd")},dataType:"json",data:a};$.ajax(r).always(function(o,e,t){if(200==t.status){if(1==o.Success){for(var a=o.Data.Chocolates,r=o.Data.Chocolates.length,i=0,n=0,s=0,c=0;c<r;c++){var l=a[c].Name.toLowerCase();-1<l.indexOf("zest")&&(n=a[c].DisplayedBar),-1<l.indexOf("raspberry")&&(i=a[c].DisplayedBar),-1<l.indexOf("latte")&&(s=a[c].DisplayedBar)}var d=[{slot:".js-slot-1",number:i},{slot:".js-slot-2",number:n},{slot:".js-slot-3",number:s}];u.slots=d,inventorVoteAnimation.slotChunkoutput(d),u.confirmationMessage(),ScrollTo({target:".home",callback:function(){$(".js-view-inventorvote").hide(),$(".js-view-thankyou").show(),$(".js-view-loader").fadeOut("fast"),u.startAnimation=!0;var e=$(".s-stats-container").offset().top,t=$(window).height(),a=e-.5*t,r=$("body").height()-t-5;$(window).on("scroll",function(){var e=window.pageYOffset,t=a<e;(t||r<=e&&!t)&&1==u.startAnimation&&(u.startAnimation=!1,inventorVoteAnimation.launchAnimation(d,0),inventorVoteAnimation.launchAnimation(d,1),inventorVoteAnimation.launchAnimation(d,2))}),appGoogleTracking.dataLayerPush({customEvent:{prize_draw:u.prizeDraw()}}),appGoogleTracking.dataLayerPush({customEvent:{participation_ID_push:o.Data.ParticipationId,consumer_ID_push:o.Data.ConsumerId,selected_bar_push:$("#barname").val(),purchased_shop_push:$("#retailer option:selected").text(),shortlisted_flavours_push:u.getFlavourName(),country_residence_push:$("#location option:selected").text(),prize_draw_push:u.prizeDraw(),first_position_push:o.Data.Rank.RankOne,second_position_push:o.Data.Rank.RankTwo,third_position_push:o.Data.Rank.RankThree}}),appGoogleTracking.dataLayerPush({customEvent:{event:"virtual-page",virtualUri:"/thank-you",pageTitle:"Thank-You"}})}});var p=$("#barname").val();appGoogleTracking.dataLayerPush({customEvent:{selected_bar:p}}),appGoogleTracking.dataLayerPush({customEvent:{purchased_shop:$("#retailer option:selected").text()}}),appGoogleTracking.dataLayerPush({customEvent:{shortlisted_flavours:u.getFlavourName()}}),appGoogleTracking.dataLayerPush({customEvent:{country_residence:$("#location option:selected").text()}}),appGoogleTracking.dataLayerPush({customEvent:{participation_ID:o.Data.ParticipationId}}),appGoogleTracking.dataLayerPush({customEvent:{consumer_ID:o.Data.ConsumerId}}),appGoogleTracking.dataLayerPush({dataEvent:"button-click",dataCategory:"Click Action",dataAction:"Vote",dataLabel:p}),u.dataLayerCookie({participation_ID_head:o.Data.ParticipationId,consumer_ID_head:o.Data.ConsumerId,selected_bar_head:p,purchased_shop_head:$("#retailer option:selected").text(),shortlisted_flavours_head:u.getFlavourName(),country_residence_head:$("#location option:selected").text(),prize_draw_head:u.prizeDraw(),week_number_head:"",first_position_head:o.Data.Rank.RankOne,second_position_head:o.Data.Rank.RankTwo,third_position_head:o.Data.Rank.RankThree})}}else $("#js-submit-vote").attr("disabled",!1),$(".js-view-loader").hide(),$(".js-select-radio-newsletter").prop("checked",!1),u.processError(o.status,o.responseJSON.Data.Error)})},dataLayerCookie:function(e){var t=JSON.stringify(e);appCookie.createCookie("cookietag",t,1)},processError:function(e,t){if(500==e)console.log("500 Server Error");else for(var a=t.length,r=0;r<a;r++)"CHOCOLATEBAR_REQUIRED"==t[r]&&($(".js-select-card").removeClass("selected"),$(".js-select-card").addClass("error-card"),ScrollTo({target:".swiper-container",callback:function(){$(".js-view-popup-error-card").fadeIn("fast")}})),"EMAIL_REQUIRED"!=t[r]&&"EMAIL_INVALID"!=t[r]&&"EMAIL_ALREADY_USED"!=t[r]||($("#email").addClass("notvalid"),$(".js-view-popup-error-email").show(),ScrollTo({target:".js-view-popup-error-email"})),"RETAILER_REQUIRED"!=t[r]&&"RETAILER_INVALID"!=t[r]||$("#retailer").addClass("notvalid"),"TRIED_FLAVOURS_REQUIRED"!=t[r]&&"TRIED_FLAVOURS_INVALID"!=t[r]||$(".container-input .radiobtn").addClass("notvalid"),"PLACE_REQUIRED"!=t[r]&&"PLACE_INVALID"!=t[r]||$("#location").addClass("notvalid"),"TERMS_CONSENT_REQUIRED"==t[r]&&$('.container-input[for="retailerconsent"] .checkmark').addClass("notvalid"),t[r]},eventHandlers:function(){var a=this;if($("#frm-vote").on("submit",function(e){return e.preventDefault(),!1}),validate.validateField("#frm-vote"),window.innerWidth<=1024)var o=new Swiper(".swiper-container",{slidesPerView:2,spaceBetween:30,centeredSlides:!0,pagination:{el:".swiper-pagination",clickable:!0},breakpoints:{640:{centeredSlides:!0,slidesPerView:1.5,spaceBetween:20},767:{centeredSlides:!0,slidesPerView:1.8,spaceBetween:20},768:{centeredSlides:!1,slidesPerView:3,pagination:!1,spaceBetween:10},800:{centeredSlides:!1,slidesPerView:3,pagination:!1,spaceBetween:50},1024:{centeredSlides:!1,slidesPerView:3,pagination:!1,spaceBetween:0}},on:{init:function(){window.innerWidth<=640&&$(".js-select-card:first").addClass("active")},slideChange:function(){$(".js-select-card").removeClass("active"),$(".js-select-card").eq(this.activeIndex).addClass("active")}}});$(".js-select-card").on("click",function(){var e=$(this),t=e.attr("data-barid"),a=e.attr("data-barname"),r=e.attr("data-slider-index");$("#barselected").val(t),$("#barname").val(a),$(".js-select-card").removeClass("selected error-card"),e.addClass("selected"),window.innerWidth<=1024&&o.slideTo(r),appGoogleTracking.dataLayerPush({dataEvent:"button-click",dataCategory:"Click Action",dataAction:"Select Bar",dataLabel:a})}),$(".js-select-radio").on("click",function(){var e=$(this),t=($("#flavourselected"),e.attr("data-type"));$(".radiobtn").removeClass("notvalid"),$("#flavourselected").val(e.val()),e.is(":checked")&&("unique"==t?$('.js-select-radio[data-type="common"]').prop("checked",!1):$('.js-select-radio[data-type="unique"]').prop("checked",!1))}),$("#js-close-popup").on("click",function(){$(".js-view-popup-error-card").fadeOut("fast"),appGoogleTracking.dataLayerPush({dataEvent:"info-click",dataCategory:"Informational Action",dataAction:"Error Popup",dataLabel:"Limited Edition Invention"})}),$("#js-close-popup-email").on("click",function(){$(".js-view-popup-error-email").fadeOut("fast"),appGoogleTracking.dataLayerPush({dataEvent:"info-click",dataCategory:"Informational Action",dataAction:"Error Popup",dataLabel:"Invalid Email Address"})}),$(".js-select-retailer").on("change",function(){var e=$("#retailer option:selected").text().toLowerCase().replace(/\s/g,"");a.retailerName=e,a.retailerOptin(e)}),$("#js-submit-vote").on("click",function(){var e=0,t=validate.validateForm("#frm-vote");""==$("#barselected").val()&&(e++,$(".js-select-card").addClass("error-card"),ScrollTo({target:".js-view-selection-bar",callback:function(){$(".js-view-popup-error-card").fadeIn("fast")}})),""==$("#flavourselected").val()&&(e++,$(".radiobtn").addClass("notvalid")),0==t&&($("#frm-vote .notvalid").first().focus(),$("#frm-vote .notvalid").first().select()),0==e&&1==t&&($("#newsletter").is(":checked")?a.processCaptcha():($(".js-view-loader-plain").show(),$(".js-view-newsletter-popup").fadeIn("slow"),appGoogleTracking.dataLayerPush({customEvent:{event:"virtual-page",virtualUri:"/opt-in",pageTitle:"Opt-in"}})))}),$("#js-submit-vote-update").on("click",function(){$("#newsletter-popup").is(":checked")?($("#newsletter-popup").siblings(".checkmark").removeClass("notvalid"),$(".js-view-loader-plain").hide(),$(".js-view-newsletter-popup").fadeOut("slow"),a.processCaptcha(),appGoogleTracking.dataLayerPush({dataEvent:"button-click",dataCategory:"Click Action",dataAction:"Keep Updated",dataLabel:document.title})):$("#newsletter-popup").siblings(".checkmark").addClass("notvalid")}),$(".js-select-radio-newsletter").on("click",function(){var e=$(this);e.is(":checked")?(e.siblings(".checkmark").removeClass("notvalid"),$("#newsletter").prop("checked",!0)):$("#newsletter").prop("checked",!1)}),$(".js-submit-vote-skip").on("click",function(){$(".js-view-loader-plain").hide(),$(".js-view-newsletter-popup").fadeOut("slow"),a.processCaptcha(),appGoogleTracking.dataLayerPush({dataEvent:"info-click",dataCategory:"Informational Action",dataAction:"Skip",dataLabel:document.title})}),$(".js-scrollto-bar").on("click",function(){ScrollTo({target:".js-view-selection-bar"}),appGoogleTracking.dataLayerPush({dataEvent:"button-click",dataCategory:"Click Action",dataAction:"Go to Vote",dataLabel:document.title})}),$("#retailer, #location").on("click",function(){var e=$(this);"default"!=e.val()?e.removeClass("notselected"):e.addClass("notselected")})},init:function(){this.eventHandlers()}};$(document).ready(function(){InventorModule.init()});
//# sourceMappingURL=home.min.js.map